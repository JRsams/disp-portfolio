<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_06fh6ii" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.4.0">
  <bpmn:message id="Message_0bj6qjp" name="Message_orderReceived" />
  <bpmn:message id="Message_11e522l" name="Message_PaymentrReceived" />
  <bpmn:collaboration id="Collaboration_1t04b0s">
    <bpmn:participant id="Participant_04izyej" name="Order" processRef="orderProcess" />
  </bpmn:collaboration>
  <bpmn:process id="orderProcess" name="orderProcess" isExecutable="true">
    <bpmn:startEvent id="StartedStartEvent" name="Started">
      <bpmn:outgoing>Flow_10zc93f</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:serviceTask id="CallRESTServiceTask" name="Call REST Service" camunda:delegateExpression="${orderDelegate}">
      <bpmn:incoming>Flow_04ixq65</bpmn:incoming>
      <bpmn:outgoing>Flow_0yz14pn</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:userTask id="EnterOrderTask" name="Enter order">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="item" label="Item Name" type="string" />
          <camunda:formField id="quantity" type="long" defaultValue="1" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_10zc93f</bpmn:incoming>
      <bpmn:incoming>Flow_1dro2v5</bpmn:incoming>
      <bpmn:incoming>shouldReorder</bpmn:incoming>
      <bpmn:outgoing>Flow_04ixq65</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="orderStatus">
      <bpmn:incoming>Flow_0yz14pn</bpmn:incoming>
      <bpmn:outgoing>resultTrue</bpmn:outgoing>
      <bpmn:outgoing>resultFalse</bpmn:outgoing>
      <bpmn:outgoing>resultNull</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:userTask id="orderSuccess" name="Confirm order success">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="orderMessage" label="Order message" type="string" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>resultTrue</bpmn:incoming>
      <bpmn:outgoing>Flow_0kgr0wp</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="outOfStock" name="Order out of stock">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="orderMessage" label="Order message" type="string" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>resultFalse</bpmn:incoming>
      <bpmn:outgoing>Flow_172irdb</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="orderError" name="Order error">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="orderMessage" label="Order message" type="string" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>resultNull</bpmn:incoming>
      <bpmn:outgoing>Flow_01tpjav</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="requestRestcok" name="Request restock">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="shouldRestock" label="Restock Item?" type="boolean" />
          <camunda:formField id="item" label="Item name" type="string" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_172irdb</bpmn:incoming>
      <bpmn:outgoing>Flow_07yujbv</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="restockGateway">
      <bpmn:incoming>Flow_07yujbv</bpmn:incoming>
      <bpmn:outgoing>notShouldRestock</bpmn:outgoing>
      <bpmn:outgoing>shouldRestock</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:userTask id="restockItem" name="Restock">
      <bpmn:incoming>shouldRestock</bpmn:incoming>
      <bpmn:outgoing>Flow_1dro2v5</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:endEvent id="Event_1h2owgw" name="Order complete">
      <bpmn:incoming>Flow_0kgr0wp</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="Event_19h1fp0" name="Order cancelled">
      <bpmn:incoming>notShouldRestock</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:userTask id="requestReorder" name="Request reorder">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="shouldReorder" label="Retry ordering?" type="boolean" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_01tpjav</bpmn:incoming>
      <bpmn:outgoing>Flow_0vpnx9r</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="reorderGateway">
      <bpmn:incoming>Flow_0vpnx9r</bpmn:incoming>
      <bpmn:outgoing>notShouldReorder</bpmn:outgoing>
      <bpmn:outgoing>shouldReorder</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="Event_17vnhbw" name="Order failed">
      <bpmn:incoming>notShouldReorder</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_04ixq65" sourceRef="EnterOrderTask" targetRef="CallRESTServiceTask" />
    <bpmn:sequenceFlow id="Flow_10zc93f" sourceRef="StartedStartEvent" targetRef="EnterOrderTask" />
    <bpmn:sequenceFlow id="Flow_0yz14pn" sourceRef="CallRESTServiceTask" targetRef="orderStatus" />
    <bpmn:sequenceFlow id="resultNull" sourceRef="orderStatus" targetRef="orderError">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${orderResult == "error"}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="resultFalse" sourceRef="orderStatus" targetRef="outOfStock">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${orderResult == "failure"}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="resultTrue" sourceRef="orderStatus" targetRef="orderSuccess">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${orderResult == "succsess"}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0kgr0wp" sourceRef="orderSuccess" targetRef="Event_1h2owgw" />
    <bpmn:sequenceFlow id="Flow_01tpjav" sourceRef="orderError" targetRef="requestReorder" />
    <bpmn:sequenceFlow id="Flow_172irdb" sourceRef="outOfStock" targetRef="requestRestcok" />
    <bpmn:sequenceFlow id="Flow_1dro2v5" sourceRef="restockItem" targetRef="EnterOrderTask" />
    <bpmn:sequenceFlow id="Flow_07yujbv" sourceRef="requestRestcok" targetRef="restockGateway" />
    <bpmn:sequenceFlow id="notShouldRestock" sourceRef="restockGateway" targetRef="Event_19h1fp0">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{not shouldRestock}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="shouldRestock" sourceRef="restockGateway" targetRef="restockItem">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{shouldRestock}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0vpnx9r" sourceRef="requestReorder" targetRef="reorderGateway" />
    <bpmn:sequenceFlow id="shouldReorder" sourceRef="reorderGateway" targetRef="EnterOrderTask">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{shouldReorder}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="notShouldReorder" sourceRef="reorderGateway" targetRef="Event_17vnhbw">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{not shouldReorder}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1t04b0s">
      <bpmndi:BPMNShape id="Participant_04izyej_di" bpmnElement="Participant_04izyej" isHorizontal="true">
        <dc:Bounds x="160" y="112" width="1370" height="708" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_04ixq65_di" bpmnElement="Flow_04ixq65">
        <di:waypoint x="440" y="460" />
        <di:waypoint x="500" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_10zc93f_di" bpmnElement="Flow_10zc93f">
        <di:waypoint x="268" y="460" />
        <di:waypoint x="340" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0yz14pn_di" bpmnElement="Flow_0yz14pn">
        <di:waypoint x="600" y="460" />
        <di:waypoint x="705" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ga04q6_di" bpmnElement="resultNull">
        <di:waypoint x="730" y="485" />
        <di:waypoint x="730" y="600" />
        <di:waypoint x="820" y="600" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0l1ctku_di" bpmnElement="resultFalse">
        <di:waypoint x="730" y="435" />
        <di:waypoint x="730" y="340" />
        <di:waypoint x="820" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0rvptrf_di" bpmnElement="resultTrue">
        <di:waypoint x="755" y="460" />
        <di:waypoint x="820" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0kgr0wp_di" bpmnElement="Flow_0kgr0wp">
        <di:waypoint x="920" y="460" />
        <di:waypoint x="1192" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_01tpjav_di" bpmnElement="Flow_01tpjav">
        <di:waypoint x="920" y="600" />
        <di:waypoint x="990" y="600" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_172irdb_di" bpmnElement="Flow_172irdb">
        <di:waypoint x="920" y="340" />
        <di:waypoint x="990" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dro2v5_di" bpmnElement="Flow_1dro2v5">
        <di:waypoint x="1160" y="200" />
        <di:waypoint x="390" y="200" />
        <di:waypoint x="390" y="420" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_07yujbv_di" bpmnElement="Flow_07yujbv">
        <di:waypoint x="1090" y="340" />
        <di:waypoint x="1185" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1jlhmmy_di" bpmnElement="notShouldRestock">
        <di:waypoint x="1235" y="340" />
        <di:waypoint x="1382" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1317tbr_di" bpmnElement="shouldRestock">
        <di:waypoint x="1210" y="315" />
        <di:waypoint x="1210" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0vpnx9r_di" bpmnElement="Flow_0vpnx9r">
        <di:waypoint x="1090" y="600" />
        <di:waypoint x="1185" y="600" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ydx5b0_di" bpmnElement="shouldReorder">
        <di:waypoint x="1210" y="625" />
        <di:waypoint x="1210" y="720" />
        <di:waypoint x="390" y="720" />
        <di:waypoint x="390" y="500" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0zqvlsj_di" bpmnElement="notShouldReorder">
        <di:waypoint x="1235" y="600" />
        <di:waypoint x="1382" y="600" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_0evdtau_di" bpmnElement="StartedStartEvent">
        <dc:Bounds x="232" y="442" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="232" y="485" width="36" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0o6x31i_di" bpmnElement="CallRESTServiceTask">
        <dc:Bounds x="500" y="420" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1tm3hfr_di" bpmnElement="EnterOrderTask">
        <dc:Bounds x="340" y="420" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0euusld_di" bpmnElement="orderStatus" isMarkerVisible="true">
        <dc:Bounds x="705" y="435" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="661" y="513" width="59" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1ytbe1m_di" bpmnElement="orderSuccess">
        <dc:Bounds x="820" y="420" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1alcfxs_di" bpmnElement="outOfStock">
        <dc:Bounds x="820" y="300" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1kf8j6o_di" bpmnElement="orderError">
        <dc:Bounds x="820" y="560" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0dovoe9_di" bpmnElement="requestRestcok">
        <dc:Bounds x="990" y="300" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_06dodlu_di" bpmnElement="restockGateway" isMarkerVisible="true">
        <dc:Bounds x="1185" y="315" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1yntzlp_di" bpmnElement="restockItem">
        <dc:Bounds x="1160" y="160" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1h2owgw_di" bpmnElement="Event_1h2owgw">
        <dc:Bounds x="1192" y="442" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1172" y="485" width="76" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_19h1fp0_di" bpmnElement="Event_19h1fp0">
        <dc:Bounds x="1382" y="322" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1361" y="365" width="78" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0nnw9t2_di" bpmnElement="requestReorder">
        <dc:Bounds x="990" y="560" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1hlw4tm_di" bpmnElement="reorderGateway" isMarkerVisible="true">
        <dc:Bounds x="1185" y="575" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_17vnhbw_di" bpmnElement="Event_17vnhbw">
        <dc:Bounds x="1382" y="582" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1371" y="625" width="58" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
